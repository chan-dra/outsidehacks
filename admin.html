<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <link rel="shortcut icon" href="public/html/assets/ico/favicon.ico">

  <title>ZEROS</title>

  <!-- Bootstrap core CSS -->
  <link href="public/html/assets/css/bootstrap.css" rel="stylesheet">

  <!-- Custom styles for this template -->
  <link href="public/html/assets/css/style.css" rel="stylesheet">
  <link href="public/html/assets/css/font-awesome.min.css" rel="stylesheet">
  <link href="public/html/assets/js/fancybox/jquery.fancybox.css" rel="stylesheet" />

  <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
</head>

<body data-spy="scroll" data-offset="0" data-target="#theMenu">

<!-- Menu -->
<nav class="menu" id="theMenu">
  <div class="menu-wrap">
    <h1 class="logo"><a href="index3.html#home">ZEROS</a></h1>
    <i class="fa fa-times menu-close"></i>
    <a href="#home" class="smoothScroll">Home</a>
    <a href="#about" class="smoothScroll">About</a>
    <a href="#contact" class="smoothScroll">Contact</a>
    <a href="#"><i class="fa fa-facebook"></i></a>
    <a href="#"><i class="fa fa-twitter"></i></a>
    <a href="#"><i class="fa fa-dribbble"></i></a>
    <a href="#"><i class="fa fa-envelope"></i></a>
  </div>

  <!-- Menu button -->
  <div id="menuToggle"><i class="fa fa-bars"></i></div>
</nav>

<section id="portfolio" name="portfolio"></section>
<div id="headerwrap">
  <h2>ZEROS</h2>
  <div class="container">
    <div class="row" align="center">
      <div class="obj-wrapper">

      </div>
      <div class="row">
        <div class="col-md-offset-4 col-md-2">
          <button class="btn btn-danger" id="newLoop"><img src="public/html/assets/img/tape.png" width="18px"/>&nbsp;&nbsp;Record a new loop</button>
        </div>
        <div class="col-md-1">
          <button class="btn btn-warning" id="existingLoops"><i class="fa fa-eye"></i>&nbsp;&nbsp;See Existing Loops</button>
        </div>
        <!-- <div class="col-md-1">
          <button class="btn btn-success" id="saveLoop">Stop and Save</button>
        </div> -->
      </div>
      <div class="row">
        <div class="col-md-offset-4 col-md-2">
          <input class="form-control" id="newLoopName">
        </div>
        <div class="col-md-1">
          <button class="btn btn-info" id="next"><i class="fa fa-hand-o-right"></i>&nbsp;&nbsp;Next</button>
        </div>
        <!-- <div class="col-md-1">
          <button class="btn btn-success" id="saveLoop">Stop and Save</button>
        </div> -->
      </div>
      <div class="row">
        <div class="col-md-offset-3 col-md-3 saveLoop">
          <i class="fa fa-circle fader" style="color:red;"></i>&nbsp;&nbsp;RECORDING
        </div>
        <div class="col-md-1">
          <button class="btn btn-success saveLoop" id="saveLoop">Save Loop</button>
        </div>
        <!-- <div class="col-md-1">
          <button class="btn btn-success" id="saveLoop">Stop and Save</button>
        </div> -->
      </div>
      
      
      <!-- <button class="btn btn-danger" id="newLoop">Record a new loop</button> -->
      
    </div>
    <br>
    <br>
    <!-- <button class="btn btn-default" id="existingLoops">See Existing Loops</button> -->
    <div id="loops">
    </div>

    <div class="row colors">
      <div class="well" style="margin-left:20px;margin-right:20px;">
        <div class="row">

          <div class="col-lg-offset-2 col-lg-1 col-md-offset-2 col-md-1 col-sm-3 col-xs-6 desc">
            <button class="color-picker btn" style="background-color:green;"></button>
          </div><!-- col-lg-1 -->

          <div class="col-lg-1 col-md-1 col-sm-3 col-xs-6 desc">
            <button class="color-picker btn" style="background-color:red;"></button>
          </div><!-- col-lg-1 -->

          <div class="col-lg-1 col-md-1 col-sm-3 col-xs-6 desc">
            <button class="color-picker btn" style="background-color:blue;"></button>
          </div><!-- col-lg-1 -->

          <div class="col-lg-1 col-md-1 col-sm-3 col-xs-6 desc">
            <button class="color-picker btn" style="background-color:black;"></button>
          </div><!-- col-lg-1 -->

          <div class="col-lg-1 col-md-1 col-sm-3 col-xs-6 desc">
            <button class="color-picker btn" style="background-color:yellow;"></button>
          </div><!-- col-lg-1 -->

          <div class="col-lg-1 col-md-1 col-sm-3 col-xs-6 desc">
            <button class="color-picker btn" style="background-color:violet;"></button>
          </div><!-- col-lg-1 -->

          <div class="col-lg-1 col-md-1 col-sm-3 col-xs-6 desc">
            <button class="color-picker btn" style="background-color:orange;"></button>
          </div><!-- col-lg-1 -->

          <div class="col-lg-1 col-md-1 col-sm-3 col-xs-6 desc">
            <button class="color-picker btn" style="background-color:white;"></button>
          </div><!-- col-lg-1 -->

        </div><!-- /row -->

      </div>
      <div class="well" style="margin-left:20px;margin-right:20px;">
        <h2>Animate</h2>
        <div class="row">

          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 desc">
            <button name="flicker" id="flicker" class="ani-picker btn" style="background-color:rgb(249, 247, 247);">Flicker</button>
          </div><!-- col-lg-4 -->

          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 desc">
            <button name="fader" id="fader" class="ani-picker btn" style="background-color:rgb(249, 247, 247);">Fade</button>
          </div><!-- col-lg-3 -->

          <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 desc">
            <button name="none" id="none" class="ani-picker btn" style="background-color:rgb(249, 247, 247);">None</button>
          </div><!-- col-lg-3 -->

        </div><!-- /row -->

      </div>
    </div>

  </div>



  <!-- Bootstrap core JavaScript
  ================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <script src="https://cdn.firebase.com/js/client/2.2.7/firebase.js"></script>
  <script src="public/html/assets/js/classie.js"></script>
  <script src="public/html/assets/js/bootstrap.min.js"></script>
  <script src="public/html/assets/js/smoothscroll.js"></script>
  <script src="public/html/assets/js/jquery.stellar.min.js"></script>
  <script src="public/html/assets/js/fancybox/jquery.fancybox.js"></script>
  <script src="public/html/assets/js/main.js"></script>
  <script>
    $(function(){
      $.stellar({
        horizontalScrolling: false,
        verticalOffset: 40
      });
    });
  </script>

  <script type="text/javascript">
    $(function() {
      //    fancybox
      jQuery(".fancybox").fancybox();
    });

    //actual starts here
    var myFirebaseRef = new Firebase("https://burning-heat-360.firebaseio.com/colors/");
    var loopRef = new Firebase("https://burning-heat-360.firebaseio.com/loops/");
    var addColorBtn = $(".color-picker.btn");
    addColorBtn.on("click", function(btn) {
      var colorCode = $(btn.currentTarget);
      if (recordLoop) {
        currentLoop.push({
          time: new Date().getTime(),
          color: colorCode.css('background-color')
        });
      } else {
        myFirebaseRef.push({
          color: colorCode.css('background-color'),
          time: new Date().getTime()
        });
      }
    });
    var addAnimationBtn = $(".ani-picker.btn");
    addAnimationBtn.on("click", function(btn) {
      var ani = $(btn.currentTarget);
      if (recordLoop) {
        currentLoop.push({
          time: new Date().getTime(),
          classType: ani.attr('name')
        });
      } else {
        myFirebaseRef.push({
          time: new Date().getTime(),
          classType: ani.attr('name')
        });
      }
    });
    var newLoopBtn = $("#newLoop");
    var currentLoop = [];
    var recordLoop = false;
    $('#newLoopName').hide();
    $('.saveLoop').hide();
    $('#next').hide();
    $('#loops').hide();
    newLoopBtn.on("click", function() {
      currentLoop = [];
      $('#newLoopName').val('');
      recordLoop = true;
      $('.colors').hide();
      $('#newLoopName').show();
      $('#existingLoops').hide()
      $('#next').show();
      newLoopBtn.hide()
    });

    $('#next').on('click', function() {
      $('.colors').show();
      $('#newLoopName').hide();
      $('#existingLoops').hide();
      $('.saveLoop').show();
      $('#next').hide();
    });

    $('#existingLoops').on('click', function() {
      $('.colors').toggle();
      $('#loops').toggle();
    });

    var saveLoop = $(".saveLoop");
    saveLoop.on("click", function() {
      recordLoop = false;
      var loopName = $("#newLoopName").val();
      for (var i = currentLoop.length - 1; i > 0; i--) {
        var current = currentLoop[i];
        current.time = current.time - currentLoop[i-1].time
      }
      currentLoop[0].time = 0;
      var loop = {
        name: loopName,
        list: currentLoop
      }
      //save to firebase
      loopRef.push(loop);
      $('.saveLoop').hide();
      $('#existingLoops').show()
      $('#existingLoops').click()
      newLoopBtn.show()

    });
    var loopsAvailable = {};
    var addFn = function (loopVal) {
      return function() {
        myFirebaseRef.push(loopVal);
      }
    }
    var loopClickFn = function(e) {
      var a = $(e.currentTarget);
      if (loopsAvailable[a.text()]) {
        var runningLoop = loopsAvailable[a.text()];
        var tm = 2;
        for (var i = 0 ; i < runningLoop.list.length; i++) {
          tm += runningLoop.list[i].time;
          setTimeout(addFn(runningLoop.list[i]), tm);
        }
      }
    }
    loopRef.on('value', function(snapshot) {
      $("#loops").empty();
      var loops = snapshot.val();
      for (var key in loops) {
        var loop = loops[key];
        loopsAvailable[loop.name] = loop;
        var loopDiv = $("<a id='loop'>"+loop.name+"</a><br/>");
        loopDiv.on('click', loopClickFn)
        $('#loops').append(loopDiv);
      }
    })
    myFirebaseRef.limitToLast(1).on("child_added", function(snapshot) {
      var data = snapshot.val()
      if (data.color) {
        $('.obj-wrapper').css('background-color', data.color);
      }
      if (data.classType) {
        if (data.classType != 'none') {
          $('.obj-wrapper').removeClass('fader');
          $('.obj-wrapper').removeClass('flicker');
          $('.obj-wrapper').addClass(data.classType)
        } else {
          $('.obj-wrapper').removeClass("flicker")
          $('.obj-wrapper').removeClass("fader")
        }
      }
    });
  </script>
</div>
</body>
</html>
